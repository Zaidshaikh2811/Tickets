%% Flow diagram for TicketForge â€” Signup and Event publish flows
sequenceDiagram
    autonumber
    participant Client as Browser / Client App
    participant Auth as Auth Service (Express)
    participant DB as Users DB (MongoDB)
    participant NATS as NATS Cluster
    participant TicketSvc as Ticket Service (subscriber)

    Note over Client,Auth: Signup flow (HTTP + JWT)
    Client->>Auth: POST /signup { email, password }
    Auth->>DB: create user document
    DB-->>Auth: user created
    Auth-->>Client: 201 Created + { jwt }

    Note over Auth,NATS: publish user-created event
    Auth->>NATS: publish user:created { id, email }
    NATS-->>TicketSvc: deliver user:created event
    TicketSvc-->>NATS: ack

    Note over Client,Auth: Authenticated request
    Client->>Auth: GET /currentuser (Authorization: Bearer <jwt>)
    Auth->>DB: lookup/validate user
    DB-->>Auth: user object
    Auth-->>Client: 200 { currentUser }

    %% Example: ticket creation (publisher flow)
    Note over Client,Auth, NATS, TicketSvc: Ticket creation + event broadcast
    Client->>Auth: POST /tickets { title, price } (authenticated)
    Auth->>DB: save ticket
    DB-->>Auth: ticket saved
    Auth->>NATS: publish ticket:created { id, title, price }
    NATS-->>TicketSvc: deliver ticket:created
    TicketSvc-->>NATS: ack

    Note over Client,TicketSvc: downstream services react to events
